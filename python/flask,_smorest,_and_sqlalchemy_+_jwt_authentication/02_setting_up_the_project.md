# Setting up the Project

This section covers:

* Project structure.
* A detailed list of steps for setting up a new project.
* Checking a project into BitBucket.

## Recommended Directory Structure

Here is the recommended directory structure for our APIs:

| Directory/File               | Purpose                                                      |
| ---------------------------- | ------------------------------------------------------------ |
| `./`                         | Project root directory.  Contains the Dockerfile and all supporting files for building/running the container. |
| `./.gitignore`               | Describes the files git should not be tracking.              |
| `./README.md`                | Contains documentation for the Docker container.             |
| `./venv`                     | Contains the Python virtual environment.  Should **not** be checked into git. |
| `./requirements.txt`         | Contains all python libraries required for building the API. |
| `./src`                      | Contains the API code                                        |
| `./src/.flaskenv`            | Contains environment variables for flask (development only.) |
| `./src/README.md`            | Contains documentation for the API itself.                   |
| `./src/api_name`             | Contains the flask app.                                      |
| `./src/api_name/__init__.py` | Makes `api_name` into a module.  Useful for testing.         |
| `./src/api_name/db.py`       | Contains a centralized database object.                      |

1. Create your project directory.

2. Create a virtual environment: From a terminal in your project directory: 

   ```
   python -m venv venv
   ```

3. Activate your virtual environment:

   ```
   ./venv/scripts/activate
   ```

   Your prompt should now look something like this:

   ```
   (venv) /path/to/project> 
   ```

4. Create a `README.md` file for your container.

5. Create a `.gitignore` file.  [Here is a recommended starter.](https://github.com/pallets/flask/blob/main/.gitignore)

6. Create your `src` directory and do the following steps inside of it.

7. Create a `README.md` file for your API.

8. Create your `requirements.txt` file:

   ```
   flask
   flask-smorest
   python-dotenv
   marshmallow
   sqlalchemy
   flask-sqlalchemy
   flask-jwt-extended
   flask_cors
   passlib
   ```

   While not comprehensive, (your API may require further packages), this is a minimal set for writing an API that includes database access, autogenerated documentation, and JWT security.

9. Install python libraries:

```
pip install -r requirements.txt
```

10. Create a `.flaskenv` file:

    ```
    FLASK_APP=api_name.app
    FLASK_DEBUG=1
    ```

    * `FLASK_APP` tells Flask where to find your application when you start it via `flask run` later.
    * `FLASK_DEBUG` tells Flask to restart when it detects file changes.  It also allows the swagger documentation UI to run a debugging session against the API.  As this is a security risk, `FLASK_DEBUG` MUST be turned off in production.	

11. Create your `api_name` directory (substituting the name of your API, of course.)

All further steps take place in your `api_name` directory.

12. Place an empty `__init__.py` file in your `api_name` directory to make it a module.

13. Create an `app.py` file with the following contents:

    ```python
    from flask import Flask
    
    def create_app(db_url=None):
        app = Flask(__name__)
    
        ## FLASK CONFIG
        app.config["PROPAGATE_EXCEPTIONS"] = True
        ### MODIFY THIS LINE AND REMOVE THESE COMMENTS ###
        app.config["API_TITLE"] = "API NAME HERE"  
        ### END OF NOTE                                ###
        app.config["API_VERSION"] = "v1"
        app.config["OPENAPI_VERSION"] = "3.0.3"
        app.config["OPENAPI_URL_PREFIX"] = "/"
        app.config["OPENAPI_SWAGGER_UI_PATH"] = "/swagger-ui"
        app.config[
            "OPENAPI_SWAGGER_UI_URL"
        ] = "https://cdn.jsdelivr.net/npm/swagger-ui-dist/"
    
        @app.route('/')
        def index():
            return "Flask is set up correctly!"
        
        return app
    ```

    Be sure to set the `API_TITLE` line appropriately and remove the surrounding comments.

15. Verify that your application is set up correctly by running this from within your `src` directory:

    ```
    flask run
    ```

    If all is well, you should get something like this as a result:

    ```
     * Serving Flask app 'api_name.app'
     * Debug mode: on
    WARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.
     * Running on http://127.0.0.1:5000
    Press CTRL+C to quit
     * Restarting with stat
     * Debugger is active!
     * Debugger PIN: 116-581-704
    ```

    You should be able to hit http://localhost:5000 and see the following response in your browser:

    ```
    Flask is set up correctly!
    ```

Your project is now set up.  

